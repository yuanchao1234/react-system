"use strict";var express=require("express"),router=express.Router(),mysql=require("mysql"),connection=mysql.createConnection({host:"localhost",user:"root",password:"root",database:"yuan"});connection.connect(),router.post("/login",function(n,t){var r,o,c,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.body,o=r.userID,c=r.password,s=r.role,t.append("Access-Control-Allow-Origin","*"),connection.query("SELECT * FROM login WHERE ? AND ? AND ?",[{userID:o},{password:c},{role:s}],function(e,n,r){if(e)throw e;console.log("The solution is: ",n),t.json(n)});case 3:case"end":return e.stop()}})}),router.get("/smessage",function(n,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.query.userID,t.append("Access-Control-Allow-Origin","*"),connection.query("SELECT * FROM student WHERE ? ",[{userID:r}],function(e,n,r){if(e)throw e;console.log("The solution is: ",n),t.json(n)});case 3:case"end":return e.stop()}})}),router.post("/repass",function(n,t){var r,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.body,o=r.userID,c=r.password,t.append("Access-Control-Allow-Origin","*"),console.log(n.body),connection.query("UPDATE login SET ? WHERE ?",[{password:c},{userID:o}],function(e,n,r){if(e)throw e;console.log("The solution is: ",n),t.json(n)});case 4:case"end":return e.stop()}})}),router.get("/course",function(e,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t.append("Access-Control-Allow-Origin","*"),connection.query("SELECT * FROM course",function(e,n,r){if(e)throw e;console.log("The solution is: ",n),t.json(n)});case 2:case"end":return e.stop()}})}),router.get("/selectcourse",function(n,t){var r,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:c=function(s){return new Promise(function(o,e){var c=[];s.map(function(e,t){connection.query("SELECT * FROM course WHERE ?",[{courseID:e.courseID}],function(e,n,r){if(e)throw e;c.push(n[0]),t+1==s.length&&(console.log(t+1),o(c))})})})},o=function(){return new Promise(function(t,e){connection.query("SELECT * FROM selectedcourse WHERE ?",[r],function(e,n,r){if(e)throw e;t(n)})})},t.append("Access-Control-Allow-Origin","*"),r=n.query,function(){var n,r;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(o());case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(c(n));case 5:r=e.sent,t.json(r);case 7:case"end":return e.stop()}})}();case 6:case"end":return e.stop()}})}),router.get("/score",function(n,o){var r,c,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:s=function(u){return new Promise(function(c,e){var s=[];u.map(function(t,o){connection.query("SELECT * FROM course WHERE ?",[{courseID:t.courseID}],function(e,n,r){if(e)throw e;n[0].mark=t.mark,s.push(n[0]),u.length==o+1&&c(s)})})})},c=function(){return new Promise(function(t,e){connection.query("SELECT * FROM selectedcourse WHERE ?",[r],function(e,n,r){if(e)throw e;t(n)})})},o.append("Access-Control-Allow-Origin","*"),r=n.query,function(){var n,r,t;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(c());case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(s(n));case 5:r=e.sent,t=r.filter(function(e,n){return 0<e.mark}),o.json(t);case 8:case"end":return e.stop()}})}();case 6:case"end":return e.stop()}})}),router.get("/insertcourse",function(n,t){var r,o,c,s,u,a,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t.append("Access-Control-Allow-Origin","*"),1*n.query.yuan?(r=n.query,o=r.courseID,c=r.userID,s=r.mark,connection.query("INSERT INTO selectedcourse (courseID, studentID, mark) VALUES (".concat(1*o,", ").concat(c,",").concat(1*s,")"),function(e,n,r){if(e)throw e;t.json(n)})):(u=n.query,a=u.courseID,i=u.userID,connection.query("SELECT * FROM selectedcourse WHERE ? AND ?",[{courseID:a},{studentID:i}],function(e,n,r){if(e)throw e;t.json(n)}));case 3:case"end":return e.stop()}})}),router.get("/tmessage",function(n,t){var r,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:c=function(o){return new Promise(function(t,e){connection.query("SELECT * FROM teacher WHERE ? ",[{userID:r}],function(e,n,r){if(e)throw e;n[0].Tname=o,t(n)})})},o=function(){return new Promise(function(t,e){connection.query("SELECT * FROM login WHERE ? ",[{userID:r}],function(e,n,r){if(e)throw e;t(n[0].userName)})})},r=n.query.userID,t.append("Access-Control-Allow-Origin","*"),function(){var n,r;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(o());case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(c(n));case 5:r=e.sent,t.json(r);case 7:case"end":return e.stop()}})}();case 6:case"end":return e.stop()}})}),router.get("/tcourse",function(n,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t.append("Access-Control-Allow-Origin","*"),r=n.query,console.log(r),connection.query("SELECT * FROM course WHERE ?",[r],function(e,n,r){if(e)throw e;t.json(n)});case 4:case"end":return e.stop()}})}),router.get("/tscore",function(n,c){var r,o,s,u,a,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:i=function(u,a,i,f){return new Promise(function(c,e){var s=[];u.map(function(t,o){connection.query("SELECT * FROM student WHERE ?",[{userID:t.studentID}],function(e,n,r){if(e)throw e;n[0].mark=t.mark,n[0].courseName=i,n[0].courseType=f,n[0].courseID=a,s.push(n[0]),o+1==u.length&&c(s)})})})},a=function(n){return new Promise(function(t,e){connection.query("SELECT * FROM selectedcourse WHERE ?",[{courseID:n}],function(e,n,r){if(e)throw e;t(n)})})},u=function(){return new Promise(function(t,e){connection.query("SELECT * FROM course WHERE ?",[{teacherID:o}],function(e,n,r){if(e)throw e;t([n[0].courseID,n[0].courseName,n[0].courseType])})})},c.append("Access-Control-Allow-Origin","*"),r=n.query,o=r.teacherID,s=r.panduan,function(){var n,r,t,o;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(u());case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(a(n[0]));case 5:return r=e.sent,e.next=8,regeneratorRuntime.awrap(i(r,n[0],n[1],n[2]));case 8:t=e.sent,o=t.filter(function(e){return 1*s?0<e.mark:0==e.mark}),c.json(o);case 11:case"end":return e.stop()}})}();case 7:case"end":return e.stop()}})}),router.get("/tpingfeng",function(n,t){var r,o,c,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:t.append("Access-Control-Allow-Origin","*"),r=n.query,o=r.courseID,c=r.studentID,s=r.mark,connection.query("UPDATE selectedcourse SET ? WHERE ? AND ?",[{mark:s},{courseID:o},{studentID:c}],function(e,n,r){if(e)throw e;t.json(n)});case 3:case"end":return e.stop()}})}),router.get("/axuehao",function(n,r){var t,o,c,s,u,a,i,f,p,w;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:w=function(){return new Promise(function(t,e){connection.query("INSERT INTO login (userID, userName, password, role) VALUES ( ".concat(c,",'").concat(o,"',123, 1 )"),function(e,n,r){if(e)throw e;t(n)})})},p=function(){return new Promise(function(t,e){connection.query("INSERT INTO student (userID, sex, birthyear, grade, college,userName) VALUES ( ".concat(c,",'").concat(s,"',").concat(u,", ").concat(a,",'").concat(i,"','").concat(o,"' )"),function(e,n,r){if(e)throw e;t(n)})})},f=function(){return new Promise(function(t,e){connection.query("SELECT * FROM student WHERE ?",[{userID:c}],function(e,n,r){if(e)throw e;t(n)})})},r.append("Access-Control-Allow-Origin","*"),t=n.query,o=t.userName,c=t.userID,s=t.sex,u=t.birthyear,a=t.grade,i=t.college,regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(f());case 2:if(!e.sent.length){e.next=7;break}r.json(1),e.next=14;break;case 7:return e.next=9,regeneratorRuntime.awrap(p());case 9:if(1*e.sent.affectedRows)return e.next=13,regeneratorRuntime.awrap(w());e.next=14;break;case 13:r.json(0);case 14:case"end":return e.stop()}});case 7:case"end":return e.stop()}})}),router.get("/agonghao",function(n,r){var t,o,c,s,u,a,i,f,p,w,m,g;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:g=function(){return new Promise(function(t,e){connection.query("INSERT INTO login (userID, userName, password, role) VALUES ( '".concat(c,"','").concat(o,"',123, 2 )"),function(e,n,r){if(e)throw e;t(n)})})},m=function(){return new Promise(function(t,e){connection.query("INSERT INTO teacher (userID, sex, birthyear,degree, title , grade, college) VALUES ( '".concat(c,"','").concat(s,"',").concat(i,",'").concat(u,"', '").concat(a,"',").concat(f,",'").concat(p,"' )"),function(e,n,r){if(e)throw e;t(n)})})},w=function(){return new Promise(function(t,e){connection.query("SELECT * FROM teacher WHERE ?",[{userID:c}],function(e,n,r){if(e)throw e;t(n)})})},r.append("Access-Control-Allow-Origin","*"),t=n.query,o=t.userName,c=t.userID,s=t.sex,u=t.degree,a=t.title,i=t.birthyear,f=t.grade,p=t.college,console.log(o,c,s,u,a,i,f,p),regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(w());case 2:if(!e.sent.length){e.next=7;break}r.json(1),e.next=14;break;case 7:return e.next=9,regeneratorRuntime.awrap(m());case 9:if(1*e.sent.affectedRows)return e.next=13,regeneratorRuntime.awrap(g());e.next=14;break;case 13:r.json(0);case 14:case"end":return e.stop()}});case 8:case"end":return e.stop()}})}),router.post("/arepass",function(n,r){var t,o,c,s,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:u=function(){return new Promise(function(t,e){connection.query("UPDATE login SET ? WHERE ?",[{password:c},{userID:o}],function(e,n,r){if(e)throw e;t(n)})})},s=function(){return new Promise(function(t,e){connection.query("SELECT * FROM login WHERE ?",[{userID:o}],function(e,n,r){if(e)throw e;t(n)})})},t=n.body,o=t.userID,c=t.password,r.append("Access-Control-Allow-Origin","*"),function(){var n;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(s());case 2:if(e.sent.length)return e.next=6,regeneratorRuntime.awrap(u());e.next=10;break;case 6:n=e.sent,r.json(n),e.next=11;break;case 10:r.json(0);case 11:case"end":return e.stop()}})}();case 6:case"end":return e.stop()}})}),router.get("/atm",function(n,t){var o,c,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:s=function(n){return new Promise(function(t,e){connection.query("SELECT * FROM course WHERE ? ",[{teacherID:n}],function(e,n,r){if(e)throw e;t(n)})})},c=function(){return new Promise(function(t,e){connection.query("SELECT * FROM teacher WHERE ? ",[{userID:o}],function(e,n,r){if(e)throw e;t(n)})})},o=n.query.userID,t.append("Access-Control-Allow-Origin","*"),function(){var n,r;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(c());case 2:if((n=e.sent).length)return e.next=6,regeneratorRuntime.awrap(s(o));e.next=12;break;case 6:r=e.sent,n[0].userName=r[0].userName,r.unshift(n[0]),t.json(r),e.next=13;break;case 12:t.json(0);case 13:case"end":return e.stop()}})}();case 6:case"end":return e.stop()}})}),router.get("/stm",function(n,c){var s,u,a,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:i=function(s){return new Promise(function(o,e){var c=[];s.map(function(e,t){connection.query("SELECT * FROM course WHERE ? ",[{courseID:e.courseID}],function(e,n,r){if(e)throw e;n[0].mark=s[t].mark,c.push(n[0]),t+1==s.length&&o(c)})})})},a=function(n){return new Promise(function(t,e){connection.query("SELECT * FROM selectedcourse WHERE ? ",[{studentID:n}],function(e,n,r){if(e)throw e;t(n)})})},u=function(){return new Promise(function(t,e){connection.query("SELECT * FROM student WHERE ? ",[{userID:s}],function(e,n,r){if(e)throw e;t(n)})})},s=n.query.userID,c.append("Access-Control-Allow-Origin","*"),function(){var n,r,t,o;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,regeneratorRuntime.awrap(u());case 3:if((r=e.sent).length)return e.next=7,regeneratorRuntime.awrap(a(s));e.next=16;break;case 7:return t=e.sent,e.next=10,regeneratorRuntime.awrap(i(t));case 10:o=e.sent,n.push(r[0]),n.push(o),c.json(n),e.next=17;break;case 16:c.json(0);case 17:case"end":return e.stop()}})}();case 7:case"end":return e.stop()}})}),router.get("/acourse",function(n,r){var t,o,c,s,u,a,i,f,p,w,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:(function(s){return new Promise(function(o,e){var c=[];s.map(function(e,t){connection.query("SELECT * FROM course WHERE ? ",[{courseID:e.courseID}],function(e,n,r){if(e)throw e;n[0].mark=s[t].mark,c.push(n[0]),t+1==s.length&&o(c)})})})}),m=function(){return new Promise(function(t,e){connection.query("INSERT INTO course (userName, teacherID, courseName,courseTime, classRoom , courseWeek, courseType,score) VALUES ( '".concat(o,"','").concat(c,"','").concat(s,"','").concat(u,"', '").concat(a,"',").concat(i,",'").concat(f,"',").concat(p," )"),function(e,n,r){if(e)throw e;t(n)})})},w=function(){return new Promise(function(t,e){connection.query("SELECT * FROM login WHERE ? AND ?",[{userID:c},{userName:o}],function(e,n,r){if(e)throw e;t(n)})})},t=n.query,o=t.userName,c=t.teacherID,s=t.courseName,u=t.courseTime,a=t.classRoom,i=t.courseWeek,f=t.courseType,p=t.score,r.append("Access-Control-Allow-Origin","*"),function(){var n;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return[],e.next=3,regeneratorRuntime.awrap(w());case 3:if(e.sent.length)return e.next=7,regeneratorRuntime.awrap(m());e.next=12;break;case 7:n=e.sent,console.log(n.affectedRows),n.affectedRows&&r.json(1),e.next=13;break;case 12:r.json(0);case 13:case"end":return e.stop()}})}();case 7:case"end":return e.stop()}})}),router.get("/scomment",function(n,o){var r,c,s,u,a,i,f;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:f=function(){return new Promise(function(t,e){connection.query("SELECT * FROM student WHERE ? ",[{userID:c}],function(e,n,r){if(e)throw e;t(n)})})},i=function(){return new Promise(function(t,e){connection.query("SELECT * FROM comment WHERE ? AND ? ",[{studentID:c},{teacherID:s}],function(e,n,r){if(e)throw e;t(n)})})},a=function(){return new Promise(function(t,e){connection.query("INSERT INTO comment (studentID, teacherID, text) VALUES ( '".concat(c,"','").concat(s,"','").concat(n.query.text,"' )"),function(e,n,r){if(e)throw e;t(n)})})},r=n.query,c=r.studentID,s=r.teacherID,u=r.id,o.append("Access-Control-Allow-Origin","*"),function(){var n,r,t;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(1==u)return e.next=3,regeneratorRuntime.awrap(a());e.next=7;break;case 3:n=e.sent,o.json(n),e.next=17;break;case 7:if(2==u)return e.next=10,regeneratorRuntime.awrap(i());e.next=17;break;case 10:return r=e.sent,e.next=13,regeneratorRuntime.awrap(f());case 13:t=e.sent,r.map(function(e,n){e.userName=t[0].userName,e.url=t[0].url}),console.log(r),o.json(r);case 17:case"end":return e.stop()}})}();case 7:case"end":return e.stop()}})}),router.get("/tcomment",function(n,t){var r,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:c=function(c){return new Promise(function(o,e){c.map(function(e,t){connection.query("SELECT * FROM student WHERE ? ",[{userID:e.studentID}],function(e,n,r){if(e)throw e;c[t].student=n[0].userName,c[t].url=n[0].url,c.length==t+1&&o(c)})})})},o=function(){return new Promise(function(t,e){connection.query("SELECT * FROM comment WHERE ? ",[{teacherID:r}],function(e,n,r){if(e)throw e;t(n)})})},r=n.query.teacherID,console.log(r),t.append("Access-Control-Allow-Origin","*"),function(){var n,r;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(o());case 2:return n=e.sent,console.log(n),e.next=6,regeneratorRuntime.awrap(c(n));case 6:r=e.sent,t.json(r);case 8:case"end":return e.stop()}})}();case 7:case"end":return e.stop()}})}),module.exports=router;